.. -*- coding: utf-8; mode: rst -*-
.. src-file: drivers/thermal/clock_cooling.c

.. _`clock_cooling_device`:

struct clock_cooling_device
===========================

.. c:type:: struct clock_cooling_device

    data for cooling device with clock

.. _`clock_cooling_device.definition`:

Definition
----------

.. code-block:: c

    struct clock_cooling_device {
        int id;
        struct device *dev;
        struct thermal_cooling_device *cdev;
        struct notifier_block clk_rate_change_nb;
        struct cpufreq_frequency_table *freq_table;
        unsigned long clock_state;
        unsigned long clock_val;
        struct clk *clk;
        struct mutex lock;
    }

.. _`clock_cooling_device.members`:

Members
-------

id
    unique integer value corresponding to each clock_cooling_device
    registered.

dev
    struct device pointer to the device being used to cool off using
    clock frequencies.

cdev
    thermal_cooling_device pointer to keep track of the
    registered cooling device.

clk_rate_change_nb
    reference to notifier block used to receive clock
    rate changes.

freq_table
    frequency table used to keep track of available frequencies.

clock_state
    integer value representing the current state of clock
    cooling devices.

clock_val
    integer value representing the absolute value of the clipped
    frequency.

clk
    struct clk reference used to enforce clock limits.

lock
    mutex lock to protect this struct.

.. _`clock_cooling_device.description`:

Description
-----------

This structure is required for keeping information of each
clock_cooling_device registered. In order to prevent corruption of this a
mutex \ ``lock``\  is used.

.. _`clock_cooling_get_idr`:

clock_cooling_get_idr
=====================

.. c:function:: int clock_cooling_get_idr(int *id)

    function to get an unique id.

    :param int \*id:
        int \* value generated by this function.

.. _`clock_cooling_get_idr.description`:

Description
-----------

This function will populate \ ``id``\  with an unique
id, using the idr API.

.. _`clock_cooling_get_idr.return`:

Return
------

0 on success, an error code on failure.

.. _`release_idr`:

release_idr
===========

.. c:function:: void release_idr(int id)

    function to free the unique id.

    :param int id:
        int value representing the unique id.

.. _`clock_cooling_get_property`:

clock_cooling_get_property
==========================

.. c:function:: int clock_cooling_get_property(struct clock_cooling_device *ccdev, unsigned long input, unsigned long *output, enum clock_cooling_property property)

    fetch a property of interest for a give cpu.

    :param struct clock_cooling_device \*ccdev:
        clock cooling device reference

    :param unsigned long input:
        query parameter

    :param unsigned long \*output:
        query return

    :param enum clock_cooling_property property:
        type of query (frequency, level, max level)

.. _`clock_cooling_get_property.description`:

Description
-----------

This is the common function to
1. get maximum clock cooling states
2. translate frequency to cooling state
3. translate cooling state to frequency
Note that the code may be not in good shape

.. _`clock_cooling_get_property.but-it-is-written-in-this-way-in-order-to`:

but it is written in this way in order to
-----------------------------------------

a) reduce duplicate code as most of the code can be shared.
b) make sure the logic is consistent when translating between
cooling states and frequencies.

.. _`clock_cooling_get_property.return`:

Return
------

0 on success, -EINVAL when invalid parameters are passed.

.. _`clock_cooling_get_level`:

clock_cooling_get_level
=======================

.. c:function:: unsigned long clock_cooling_get_level(struct thermal_cooling_device *cdev, unsigned long freq)

    return the cooling level of given clock cooling.

    :param struct thermal_cooling_device \*cdev:
        reference of a thermal cooling device of used as clock cooling device

    :param unsigned long freq:
        the frequency of interest

.. _`clock_cooling_get_level.description`:

Description
-----------

This function will match the cooling level corresponding to the
requested \ ``freq``\  and return it.

.. _`clock_cooling_get_level.return`:

Return
------

The matched cooling level on success or THERMAL_CSTATE_INVALID
otherwise.

.. _`clock_cooling_get_frequency`:

clock_cooling_get_frequency
===========================

.. c:function:: unsigned long clock_cooling_get_frequency(struct clock_cooling_device *ccdev, unsigned long level)

    get the absolute value of frequency from level.

    :param struct clock_cooling_device \*ccdev:
        clock cooling device reference

    :param unsigned long level:
        cooling level

.. _`clock_cooling_get_frequency.description`:

Description
-----------

This function matches cooling level with frequency. Based on a cooling level
of frequency, equals cooling state of cpu cooling device, it will return
the corresponding frequency.
e.g level=0 --> 1st MAX FREQ, level=1 ---> 2nd MAX FREQ, .... etc

.. _`clock_cooling_get_frequency.return`:

Return
------

0 on error, the corresponding frequency otherwise.

.. _`clock_cooling_apply`:

clock_cooling_apply
===================

.. c:function:: int clock_cooling_apply(struct clock_cooling_device *ccdev, unsigned long cooling_state)

    function to apply frequency clipping.

    :param struct clock_cooling_device \*ccdev:
        clock_cooling_device pointer containing frequency clipping data.

    :param unsigned long cooling_state:
        value of the cooling state.

.. _`clock_cooling_apply.description`:

Description
-----------

Function used to make sure the clock layer is aware of current thermal
limits. The limits are applied by updating the clock rate in case it is
higher than the corresponding frequency based on the requested cooling_state.

.. _`clock_cooling_apply.return`:

Return
------

0 on success, an error code otherwise (-EINVAL in case wrong
cooling state).

.. _`clock_cooling_clock_notifier`:

clock_cooling_clock_notifier
============================

.. c:function:: int clock_cooling_clock_notifier(struct notifier_block *nb, unsigned long event, void *data)

    notifier callback on clock rate changes.

    :param struct notifier_block \*nb:
        struct notifier_block \* with callback info.

    :param unsigned long event:
        value showing clock event for which this function invoked.

    :param void \*data:
        callback-specific data

.. _`clock_cooling_clock_notifier.description`:

Description
-----------

Callback to hijack the notification on clock transition.
Every time there is a clock change, we intercept all pre change events
and block the transition in case the new rate infringes thermal limits.

.. _`clock_cooling_clock_notifier.return`:

Return
------

NOTIFY_DONE (success) or NOTIFY_BAD (new_rate > thermal limit).

.. _`clock_cooling_get_max_state`:

clock_cooling_get_max_state
===========================

.. c:function:: int clock_cooling_get_max_state(struct thermal_cooling_device *cdev, unsigned long *state)

    callback function to get the max cooling state.

    :param struct thermal_cooling_device \*cdev:
        thermal cooling device pointer.

    :param unsigned long \*state:
        fill this variable with the max cooling state.

.. _`clock_cooling_get_max_state.description`:

Description
-----------

Callback for the thermal cooling device to return the clock
max cooling state.

.. _`clock_cooling_get_max_state.return`:

Return
------

0 on success, an error code otherwise.

.. _`clock_cooling_get_cur_state`:

clock_cooling_get_cur_state
===========================

.. c:function:: int clock_cooling_get_cur_state(struct thermal_cooling_device *cdev, unsigned long *state)

    function to get the current cooling state.

    :param struct thermal_cooling_device \*cdev:
        thermal cooling device pointer.

    :param unsigned long \*state:
        fill this variable with the current cooling state.

.. _`clock_cooling_get_cur_state.description`:

Description
-----------

Callback for the thermal cooling device to return the clock
current cooling state.

.. _`clock_cooling_get_cur_state.return`:

Return
------

0 (success)

.. _`clock_cooling_set_cur_state`:

clock_cooling_set_cur_state
===========================

.. c:function:: int clock_cooling_set_cur_state(struct thermal_cooling_device *cdev, unsigned long state)

    function to set the current cooling state.

    :param struct thermal_cooling_device \*cdev:
        thermal cooling device pointer.

    :param unsigned long state:
        set this variable to the current cooling state.

.. _`clock_cooling_set_cur_state.description`:

Description
-----------

Callback for the thermal cooling device to change the clock cooling
current cooling state.

.. _`clock_cooling_set_cur_state.return`:

Return
------

0 on success, an error code otherwise.

.. _`clock_cooling_register`:

clock_cooling_register
======================

.. c:function:: struct thermal_cooling_device *clock_cooling_register(struct device *dev, const char *clock_name)

    function to create clock cooling device.

    :param struct device \*dev:
        struct device pointer to the device used as clock cooling device.

    :param const char \*clock_name:
        string containing the clock used as cooling mechanism.

.. _`clock_cooling_register.description`:

Description
-----------

This interface function registers the clock cooling device with the name
"thermal-clock-%x". The cooling device is based on clock frequencies.
The struct device is assumed to be capable of DVFS transitions.
The OPP layer is used to fetch and fill the available frequencies for
the referred device. The ordered frequency table is used to control
the clock cooling device cooling states and to limit clock transitions
based on the cooling state requested by the thermal framework.

.. _`clock_cooling_register.return`:

Return
------

a valid struct thermal_cooling_device pointer on success,
on failure, it returns a corresponding \ :c:func:`ERR_PTR`\ .

.. _`clock_cooling_unregister`:

clock_cooling_unregister
========================

.. c:function:: void clock_cooling_unregister(struct thermal_cooling_device *cdev)

    function to remove clock cooling device.

    :param struct thermal_cooling_device \*cdev:
        thermal cooling device pointer.

.. _`clock_cooling_unregister.description`:

Description
-----------

This interface function unregisters the "thermal-clock-%x" cooling device.

.. This file was automatic generated / don't edit.

